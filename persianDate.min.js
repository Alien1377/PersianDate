// Persian Date
// Version 0.1.7
// Author Reza Babakhani
// written under the GPL version 2.0
// All Unit test passed , work on  Chrome / Opera / FF / IE 7,8,9
(function(){String.prototype.toPersianDigit=function(C){return this.replace(/\d+/g,function(H){var F=[],G=[],E,D;for(E=0;E<H.length;E+=1){F.push(H.charCodeAt(E))}for(D=0;D<F.length;D+=1){G.push(String.fromCharCode(F[D]+((!!C&&C===true)?1584:1728)))}return G.join("")})};var n={1:{name:{fa:"فروردین"},abbr:{fa:"فرو"}},2:{name:{fa:"اردیبهشت"},abbr:{fa:"ارد"}},3:{name:{fa:"خرداد"},abbr:{fa:"خرد"}},4:{name:{fa:"تیر"},abbr:{fa:"تیر"}},5:{name:{fa:"مرداد"},abbr:{fa:"مرد"}},6:{name:{fa:"شهریور"},abbr:{fa:"شهر"}},7:{name:{fa:"مهر"},abbr:{fa:"مهر"}},8:{name:{fa:"آبان"},abbr:{fa:"آبا"}},9:{name:{fa:"آذر"},abbr:{fa:"آذر"}},10:{name:{fa:"دی"},abbr:{fa:"دی"}},11:{name:{fa:"بهمن"},abbr:{fa:"بهم"}},12:{name:{fa:"اسفند"},abbr:{fa:"اسف"}}},b={0:{name:{fa:"شنبه"},abbr:{fa:"ش"}},1:{name:{fa:"یکشنبه"},abbr:{fa:"ی"}},2:{name:{fa:"دوشنبه"},abbr:{fa:"د"}},3:{name:{fa:"سه شنبه"},abbr:{fa:"س"}},4:{name:{fa:"چهار شنبه"},abbr:{fa:"چ"}},5:{name:{fa:"پنج شنبه"},abbr:{fa:"پ"}},6:{name:{fa:"جمعه"},abbr:{fa:"ج"}}},w=["اورمزد","بهمن","اوردیبهشت","شهریور","سپندارمذ","خورداد","امرداد","دی به آذز","آذز","آبان","خورشید","ماه","تیر","گوش","دی به مهر","مهر","سروش","رشن","فروردین","بهرام","رام","باد","دی به دین","دین","ارد","اشتاد","آسمان","زامیاد","مانتره سپند","انارام","زیادی"],v=function(C){return C.toString().toPersianDigit()},o=function(C){return Object.prototype.toString.call(C)==="[object Array]"},p=function(C){return typeof C==="string"?true:false},r=function(C){return typeof C==="number"?true:false},A=function(C){return C instanceof Date},e=function(C){if(typeof C==="undefined"){return true}else{return false}},j=function(E,D){var C=E+"";while(C.length<D){C="0"+C}return C},l=function(C){if(C<0){return Math.ceil(C)}else{return Math.floor(C)}},B=function(D,C){return D-(C*Math.floor(D/C))},q=1721425.5,h=1948320.5,z=function(C){return B(Math.floor((C+1.5)),7)},g=function(C){return((C%4)==0)&&(!(((C%100)===0)&&((C%400)!=0)))},s=function(C){return((((((C-((C>0)?474:473))%2820)+474)+38)*682)%2816)<682},u=function(D,E,C){return(q-1)+(365*(D-1))+Math.floor((D-1)/4)+(-Math.floor((D-1)/100))+Math.floor((D-1)/400)+Math.floor((((367*E)-362)/12)+((E<=2)?0:(g(D)?-1:-2))+C)},f=function(L){var I,O,G,D,N,C,P,E,H,M,J,F,K;I=Math.floor(L-0.5)+0.5;O=I-q;G=Math.floor(O/146097);D=B(O,146097);N=Math.floor(D/36524);C=B(D,36524);P=Math.floor(C/1461);E=B(C,1461);H=Math.floor(E/365);J=(G*400)+(N*100)+(P*4)+H;if(!((N==4)||(H==4))){J++}F=I-u(J,1,1);K=((I<u(J,3,1))?0:(g(J)?1:2));month=Math.floor((((F+K)*12)+373)/367);day=(I-u(J,month,1))+1;return new Array(J,month,day)},m=function(D,G,C){B=function(I,H){return I-(H*Math.floor(I/H))};var F,E;F=D-((D>=0)?474:473);E=474+B(F,2820);return C+((G<=7)?((G-1)*31):(((G-1)*30)+6))+Math.floor(((E*682)-110)/2816)+(E-1)*365+Math.floor(F/2820)*1029983+(h-1)},d=function(L){var J,I,K,M,G,C,H,F,E,D;L=Math.floor(L)+0.5;M=L-m(475,1,1);G=Math.floor(M/1029983);C=B(M,1029983);if(C===1029982){H=2820}else{F=Math.floor(C/366);E=B(C,366);H=Math.floor(((2134*F)+(2816*E)+2815)/1028522)+F+1}J=H+(2820*G)+474;if(J<=0){J-=1}D=(L-m(J,1,1))+1;I=(D<=186)?Math.ceil(D/31):Math.ceil((D-6)/30);K=(L-m(J,I,1))+1;return new Array(J,I,K)},c=function(F,G,C){var E,D;var D=m(F,G,C);var E=f(D);return new Array(E[0],E[1]-1,E[2])},k=function(F,H,C){var E=u(F,H+1,C)+(Math.floor(0+60*(0+60*0)+0.5)/86400),D=d(E),G=z(E);return new Array(D[0],D[1],D[2],G)},i=function(E){var D=k(E.getFullYear(),E.getMonth(),E.getDate());var C={};C.monthDayNumber=D[2]-1;if(D[3]==6){C.weekDayNumber=0}else{C.weekDayNumber=D[3]+1}C.year=D[0];C.month=D[1];C.day=D[3];C.date=D[2];C.hours=E.getHours();C.minutes=((E.getMinutes()<10)?("0"+E.getMinutes()):(E.getMinutes()));C.seconds=E.getSeconds();C.milliseconds=E.getMilliseconds();C.timeZoneOffset=E.getTimezoneOffset();return C},t=function(E){var D=c(E[0]?E[0]:0,E[1]?E[1]:1,E[2]?E[2]:1);var C=new Date(D[0],D[1],D[2]);C.setYear(D[0]);C.setMonth(D[1]);C.setDate(D[2]);C.setHours(E[3]?E[3]:0);C.setMinutes(E[4]?E[4]:0);C.setSeconds(E[5]?E[5]:0);return C},y=function(C){return[C.year,C.month,C.date,C.hours,C.minutes,C.seconds,C.milliseconds]},a=function(G){var J=function(N){if(N<0){return Math.ceil(N)}else{return Math.floor(N)}},H=this._data={},I=G.years||G.year||G.y||0,D=G.months||G.month||G.M||0,C=G.weeks||G.w||G.week||0,M=G.days||G.d||G.day||0,K=G.hours||G.hour||G.h||0,F=G.minutes||G.minute||G.m||0,L=G.seconds||G.second||G.s||0,E=G.milliseconds||G.millisecond||G.ms||0;this._milliseconds=E+L*(1000)+F*(60000)+K*(3600000);this._days=M+C*7;this._months=D+I*12;H.milliseconds=E%1000;L+=J(E/1000);H.seconds=L%60;F+=J(L/60);H.minutes=F%60;K+=J(F/60);H.hours=K%24;M+=J(K/24);M+=C*7;H.days=M%30;D+=J(M/30);H.months=D%12;I+=J(D/12);H.years=I;return this},x=function(D){if(!(this instanceof x)){return new x(D)}if(e(D)){this.gDate=new Date()}else{if(A(D)){this.gDate=D}else{if(o(D)){var C=D.slice();this.gDate=t(C)}else{if(r(D)){this.gDate=new Date(D)}else{if(D instanceof x){this.gDate=D.gDate}else{if(D.substring(0,6)==="/Date("){this.gDate=new Date(parseInt(D.substr(6)))}}}}}}this.pDate=i(this.gDate);return this};a.prototype={weeks:function(){return"Must Implement"},valueOf:function(){return this._milliseconds+this._days*(86400000)+this._months*(2592000000)},humanize:function(C){return"Must Implement"}};x.prototype={duration:function(C,G){var F=this.isDuration(C),E=(typeof C==="number"),H=(F?C._data:(E?{}:C)),D;if(E){if(G){H[G]=C}else{H.milliseconds=C}}return new a(H)},isDuration:function(C){return C instanceof a},humanize:function(){return"Must Implement"},add:function(D,C){var F=this.duration(C,D).valueOf(),E=this.gDate.valueOf()+F;return new x(E)},subtract:function(D,C){var F=this.duration(C,D).valueOf(),E=this.gDate.valueOf()-F;return new x(E)},formatPersian:"_default",formatNumber:function(){var C;if(this.formatPersian==="_default"){if(window.formatPersian===false){C=false}else{C=true}}else{if(this.formatPersian===true){C=true}else{if(this.formatPersian===false){C=false}else{$.error("Invalid Config 'formatPersian' !!")}}}return C},format:function(G){var C=this,D=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DD?D?D?|ddddd|dddd?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?|X|LT|ll?l?l?|LL?L?L?)/g,E={year:C.year(),month:C.month(),hour:C.hours(),minute:C.minutes(),second:C.seconds(),date:C.date(),timezone:C.zone(),unix:C.unix()};function F(J){formatToPersian=C.formatNumber();switch(J){case ("a"):if(formatToPersian){return((E.hour>=12)?"ب ظ":"ق ظ")}else{return((E.hour>=12)?"PM":"AM")}case ("H"):if(formatToPersian){return v(E.hour)}else{return E.hour}case ("HH"):if(formatToPersian){return v(j(E.hour,2))}else{return j(E.hour,2)}case ("h"):var M=E.hour%12;if(formatToPersian){return v(M)}else{return M}case ("hh"):var M=E.hour%12;if(formatToPersian){return v(j(M,2))}else{return j(M,2)}case ("m"):if(formatToPersian){return v(E.minute)}else{return E.minute}case ("mm"):if(formatToPersian){return v(j(E.minute,2))}else{return j(E.minute,2)}case ("s"):if(formatToPersian){return v(E.second)}else{return E.second}case ("ss"):if(formatToPersian){return v(j(E.second,2))}else{return j(E.second,2)}case ("D"):if(formatToPersian){return v(j(E.date))}else{return j(E.date)}case ("DD"):if(formatToPersian){return v(j(E.date,2))}else{return j(E.date,2)}case ("DDD"):var L=C.startOf("year");return C.diff(L,"days");case ("DDDD"):var L=C.startOf("year");return j(C.diff(L,"days"),3);case ("d"):return C.pDate.weekDayNumber;case ("ddd"):return b[C.pDate.weekDayNumber].abbr.fa;case ("dddd"):return b[C.pDate.weekDayNumber].name.fa;case ("ddddd"):return w[C.pDate.monthDayNumber];case ("w"):var L=C.startOf("year");return parseInt(C.diff(L,"days")/7)+1;case ("ww"):var L=C.startOf("year");return j(parseInt(C.diff(L,"days")/7)+1,2);case ("M"):if(formatToPersian){return v(E.month)}else{return E.month}case ("MM"):if(formatToPersian){return v(j(E.month,2))}else{return j(E.month,2)}case ("MMM"):return n[E.month].abbr.fa;case ("MMMM"):return n[E.month].name.fa;case ("YY"):var N=E.year.toString().split("");if(formatToPersian){return v(N[2]+N[3])}else{return N[2]+N[3]}case ("YYYY"):if(formatToPersian){return v(E.year)}else{return E.year}case ("Z"):var I="+";var H=Math.round(E.timezone/60);var K=E.timezone%60;if(K<0){K*=-1}if(H<0){I="-";H*=-1}var O=I+j(H,2)+":"+j(K,2);if(formatToPersian){return v(O)}else{return O}case ("ZZ"):var I="+";var H=Math.round(E.timezone/60);var K=E.timezone%60;if(K<0){K*=-1}if(H<0){I="-";H*=-1}var O=I+j(H,2)+""+j(K,2);if(formatToPersian){return v(O)}else{return O}case ("X"):return C.unix();case ("LT"):return C.format("h:m a");case ("L"):return C.format("YYYY/MM/DD");case ("l"):return C.format("YYYY/M/D");case ("LL"):return C.format("MMMM DD YYYY");case ("ll"):return C.format("MMM DD YYYY");case ("LLL"):return C.format("MMMM YYYY DD   h:m  a");case ("lll"):return C.format("MMM YYYY DD   h:m  a");case ("LLLL"):return C.format("dddd D MMMM YYYY  h:m  a");case ("llll"):return C.format("ddd D MMM YYYY  h:m  a");default:return E._d}}if(G){return G.replace(D,F)}else{var G="YYYY-MM-DD HH:mm:ss a";return G.replace(D,F)}},from:function(){return"Must Implement"},fromNow:function(){return"Must Implement"},humanizeDuration:function(){return"Must Implement"},_d:function(){return this.gDate._d},diff:function(J,E,M){var L=new x(this),C=J,G=0,K=L.gDate-C.gDate-G,I=L.year()-C.year(),H=L.month()-C.month(),F=(L.date()-C.date())*-1,D;if(E==="months"||E==="month"){D=I*12+H+F/30}else{if(E==="years"||E==="year"){D=I+(H+F/30)/12}else{D=E==="seconds"||E==="second"?K/1000:E==="minutes"||E==="minute"?K/60000:E==="hours"||E==="hour"?K/3600000:E==="days"||E==="day"?K/86400000:E==="weeks"||E==="week"?K/604800000:K}}if(D<0){D*-1}return M?D:Math.round(D)},startOf:function(D){switch(D){case"years":case"year":return new x([this.year(),1,1]);case"months":case"month":return new x([this.year(),this.month(),1]);case"days":case"day":return new x([this.year(),this.month(),this.date(),0,0,0]);case"hours":case"hour":return new x([this.year(),this.month(),this.date(),this.hours(),0,0]);case"minutes":case"minute":return new x([this.year(),this.month(),this.date(),this.hours(),this.minutes(),0]);case"seconds":case"second":return new x([this.year(),this.month(),this.date(),this.hours(),this.minutes(),this.seconds()]);case"weeks":case"week":var C=this.pDate.weekDayNumber;if(C===0){return new x([this.year(),this.month(),this.date()])}else{return new x([this.year(),this.month(),this.date()]).subtract("days",C)}default:return this}},endOf:function(D){switch(D){case"years":case"year":var F=this.isLeapYear()?30:29;return new x([this.year(),12,F,23,59,59]);case"months":case"month":var E=this.daysInMonth(this.year(),this.month());return new x([this.year(),this.month(),E,23,59,59]);case"days":case"day":return new x([this.year(),this.month(),this.date(),23,59,59]);case"hours":case"hour":return new x([this.year(),this.month(),this.date(),this.hours(),59,59]);case"minutes":case"minute":return new x([this.year(),this.month(),this.date(),this.hours(),this.minutes(),59]);case"seconds":case"second":return new x([this.year(),this.month(),this.date(),this.hours(),this.minutes(),this.seconds()]);case"weeks":case"week":var C=this.pDate.weekDayNumber;if(C===6){C=7}else{C=6-C}return new x([this.year(),this.month(),this.date()]).add("days",C);default:return this}},sod:function(){return this.startOf("day")},eod:function(){return this.endOf("day")},zone:function(){return this.pDate.timeZoneOffset},_utcMode:false,local:function(){if(!this._utcMode){return this}else{var C=this.pDate.timeZoneOffset*60*1000;if(this.pDate.timeZoneOffset<0){var D=this.valueOf()-C}else{var D=this.valueOf()+C}this.gDate=new Date(D);this._updatePDate();this._utcMode=false;return this}},utc:function(D){if(D){return new persianDate(D).utc()}if(this._utcMode){return this}else{var C=this.pDate.timeZoneOffset*60*1000;if(this.pDate.timeZoneOffset<0){var E=this.valueOf()+C}else{var E=this.valueOf()-C}this.gDate=new Date(E);this._updatePDate();this._utcMode=true;return this}},isUtc:function(){return this._utcMode},isDST:function(){var C=false;if(this.month()>=1&&this.month()<=6){C=true;switch(this.month()){case (1):if(this.date()<2){C=false}break;case (6):if(this.date()>30){C=false}break}}return C},isLeapYear:function(){return s(this.year())},daysInMonth:function(D,F){var C=D?D:this.year();var E=F?F:this.month();if(E<1||E>12){return 0}if(E<7){return 31}if(E<12){return 30}if(s(C)){return 30}return 29},toDate:function(){return this.gDate},toArray:function(){return[this.year(),this.month(),this.day(),this.hour(),this.minute(),this.second(),this.millisecond()]},_valueOf:function(){return this.gDate.valueOf()},unix:function(C){if(C){return new persianDate(C*1000)}else{var D=this.gDate.valueOf().toString();output=D.substring(0,D.length-3)}return parseInt(output)},isPersianDate:function(C){return C instanceof x},millisecond:function(C){return this.milliseconds(C)},milliseconds:function(C){if(C){this.gDate.setMilliseconds(C);this._updatePDate();return this}else{return this.pDate.milliseconds}},second:function(C){return this.seconds(C)},seconds:function(C){if(C|C===0){this.gDate.setSeconds(C);this._updatePDate();return this}else{return this.pDate.seconds}},minute:function(C){return this.minutes(C)},minutes:function(C){if(C||C===0){this.gDate.setMinutes(C);this._updatePDate();return this}else{return this.pDate.minutes}},hour:function(C){return this.hours(C)},hours:function(C){if(C|C===0){this.gDate.setHours(C);this._updatePDate();return this}else{return this.pDate.hours}},dates:function(C){return this.date(C)},date:function(D){if(D|D==0){var C=y(this.pDate);C[2]=D;this.gDate=t(C);this._updatePDate();return this}else{return this.pDate.date}},days:function(){return this.day()},day:function(){return this.pDate.day+1},month:function(D){if(D|D===0){var C=y(this.pDate);C[1]=D;this.gDate=t(C);this._updatePDate();return this}else{return this.pDate.month}},years:function(C){return this.year(C)},year:function(D){if(D|D===0){var C=y(this.pDate);C[0]=D;this.gDate=t(C);this._updatePDate();return this}else{return this.pDate.year}},getFirstWeekDayOfMonth:function(D,F){var E=c(D,F,1),C=k(E[0],E[1],E[2]);if(C[3]+2===8){return 1}else{if(C[3]+2===7){return 7}else{return C[3]+2}}},clone:function(){var C=this;return new x(C.gDate)},version:"0.1.7",_updatePDate:function(){this.pDate=i(this.gDate)},valueOf:function(){return this._valueOf()}};persianDate=x;pDate=x;persianDate.unix=persianDate.prototype.unix;persianDate.utc=persianDate.prototype.utc}());