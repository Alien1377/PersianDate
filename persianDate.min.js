// Persian Date
// Version 0.1.6
// Author Reza Babakhani
// written under the GPL version 2.0
// All Unit test passed , work on  Chrome / Opera / FF / IE 7,8,9
(function(){String.prototype.toPersianDigit=function(e){return this.replace(/\d+/g,function(t){var n=[],r=[],i,s;for(i=0;i<t.length;i+=1){n.push(t.charCodeAt(i))}for(s=0;s<n.length;s+=1){r.push(String.fromCharCode(n[s]+(!!e&&e===true?1584:1728)))}return r.join("")})};var e={1:{name:{fa:"فروردین"},abbr:{fa:"فرو"}},2:{name:{fa:"اردیبهشت"},abbr:{fa:"ارد"}},3:{name:{fa:"خرداد"},abbr:{fa:"خرد"}},4:{name:{fa:"تیر"},abbr:{fa:"تیر"}},5:{name:{fa:"مرداد"},abbr:{fa:"مرد"}},6:{name:{fa:"شهریور"},abbr:{fa:"شهر"}},7:{name:{fa:"مهر"},abbr:{fa:"مهر"}},8:{name:{fa:"آبان"},abbr:{fa:"آبا"}},9:{name:{fa:"آذر"},abbr:{fa:"آذر"}},10:{name:{fa:"دی"},abbr:{fa:"دی"}},11:{name:{fa:"بهمن"},abbr:{fa:"بهم"}},12:{name:{fa:"اسفند"},abbr:{fa:"اسف"}}},t={0:{name:{fa:"شنبه"},abbr:{fa:"ش"}},1:{name:{fa:"یکشنبه"},abbr:{fa:"ی"}},2:{name:{fa:"دوشنبه"},abbr:{fa:"د"}},3:{name:{fa:"سه شنبه"},abbr:{fa:"س"}},4:{name:{fa:"چهار شنبه"},abbr:{fa:"چ"}},5:{name:{fa:"پنج شنبه"},abbr:{fa:"پ"}},6:{name:{fa:"جمعه"},abbr:{fa:"ج"}}},n=["اورمزد","بهمن","اوردیبهشت","شهریور","سپندارمذ","خورداد","امرداد","دی به آذز","آذز","آبان","خورشید","ماه","تیر","گوش","دی به مهر","مهر","سروش","رشن","فروردین","بهرام","رام","باد","دی به دین","دین","ارد","اشتاد","آسمان","زامیاد","مانتره سپند","انارام","زیادی"],r=function(e){return e.toString().toPersianDigit()},i=function(e){return Object.prototype.toString.call(e)==="[object Array]"},s=function(e){return typeof e==="string"?true:false},o=function(e){return typeof e==="number"?true:false},u=function(e){return e instanceof Date},a=function(e){if(typeof e==="undefined")return true;else return false},f=function(e,t){var n=e+"";while(n.length<t){n="0"+n}return n},l=function(e){if(e<0){return Math.ceil(e)}else{return Math.floor(e)}},c=function(e,t){return e-t*Math.floor(e/t)},h=1721425.5,p=1948320.5,d=function(e){return c(Math.floor(e+1.5),7)},v=function(e){return e%4==0&&!(e%100===0&&e%400!=0)},m=function(e){return((e-(e>0?474:473))%2820+474+38)*682%2816<682},g=function(e,t,n){return h-1+365*(e-1)+Math.floor((e-1)/4)+ -Math.floor((e-1)/100)+Math.floor((e-1)/400)+Math.floor((367*t-362)/12+(t<=2?0:v(e)?-1:-2)+n)},y=function(e){var t,n,r,i,s,o,u,a,f,l,p,d,m;t=Math.floor(e-.5)+.5;n=t-h;r=Math.floor(n/146097);i=c(n,146097);s=Math.floor(i/36524);o=c(i,36524);u=Math.floor(o/1461);a=c(o,1461);f=Math.floor(a/365);p=r*400+s*100+u*4+f;if(!(s==4||f==4)){p++}d=t-g(p,1,1);m=t<g(p,3,1)?0:v(p)?1:2;month=Math.floor(((d+m)*12+373)/367);day=t-g(p,month,1)+1;return new Array(p,month,day)},b=function(e,t,n){c=function(e,t){return e-t*Math.floor(e/t)};var r,i;r=e-(e>=0?474:473);i=474+c(r,2820);return n+(t<=7?(t-1)*31:(t-1)*30+6)+Math.floor((i*682-110)/2816)+(i-1)*365+Math.floor(r/2820)*1029983+(p-1)},w=function(e){var t,n,r,i,s,o,u,a,f,l;e=Math.floor(e)+.5;i=e-b(475,1,1);s=Math.floor(i/1029983);o=c(i,1029983);if(o===1029982){u=2820}else{a=Math.floor(o/366);f=c(o,366);u=Math.floor((2134*a+2816*f+2815)/1028522)+a+1}t=u+2820*s+474;if(t<=0){t-=1}l=e-b(t,1,1)+1;n=l<=186?Math.ceil(l/31):Math.ceil((l-6)/30);r=e-b(t,n,1)+1;return new Array(t,n,r)},E=function(e,t,n){var r,i;var i=b(e,t,n);var r=y(i);return new Array(r[0],r[1]-1,r[2])},S=function(e,t,n){var r=g(e,t+1,n)+Math.floor(0+60*(0+60*0)+.5)/86400,i=w(r),s=d(r);return new Array(i[0],i[1],i[2],s)},x=function(e){var t=S(e.getFullYear(),e.getMonth(),e.getDate());var n={};n.monthDayNumber=t[2]-1;if(t[3]==6){n.weekDayNumber=0}else{n.weekDayNumber=t[3]+1}n.year=t[0];n.month=t[1];n.day=t[3];n.date=t[2];n.hours=e.getHours();n.minutes=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes();n.seconds=e.getSeconds();n.milliseconds=e.getMilliseconds();n.timeZoneOffset=e.getTimezoneOffset();return n},T=function(e){var t=E(e[0]?e[0]:0,e[1]?e[1]:1,e[2]?e[2]:1);var n=new Date(t[0],t[1],t[2]);n.setYear(t[0]);n.setMonth(t[1]);n.setDate(t[2]);n.setHours(e[3]?e[3]:0);n.setMinutes(e[4]?e[4]:0);n.setSeconds(e[5]?e[5]:0);return n},N=function(e){return[e.year,e.month,e.date,e.hours,e.minutes,e.seconds,e.milliseconds]},C=function(e){var t=function(e){if(e<0){return Math.ceil(e)}else{return Math.floor(e)}},n=this._data={},r=e.years||e.y||0,i=e.months||e.M||0,s=e.weeks||e.w||0,o=e.days||e.d||0,u=e.hours||e.h||0,a=e.minutes||e.m||0,f=e.seconds||e.s||0,l=e.milliseconds||e.ms||0;this._milliseconds=l+f*1e3+a*6e4+u*36e5;this._days=o+s*7;this._months=i+r*12;n.milliseconds=l%1e3;f+=t(l/1e3);n.seconds=f%60;a+=t(f/60);n.minutes=a%60;u+=t(a/60);n.hours=u%24;o+=t(u/24);o+=s*7;n.days=o%30;i+=t(o/30);n.months=i%12;r+=t(i/12);n.years=r;return this},k=function(e){if(a(e)){this.gDate=new Date}else if(u(e)){this.gDate=e}else if(i(e)){var t=e.slice();this.gDate=T(t)}else if(o(e)){this.gDate=new Date(e)}else if(e instanceof k){this.gDate=e.gDate}else if(e.substring(0,6)==="/Date("){this.gDate=new Date(parseInt(e.substr(6)))}this.pDate=x(this.gDate);return this};C.prototype={weeks:function(){return"Must Implement"},valueOf:function(){return this._milliseconds+this._days*864e5+this._months*2592e6},humanize:function(e){return"Must Implement"}};k.prototype={duration:function(e,t){var n=this.isDuration(e),r=typeof e==="number",i=n?e._data:r?{}:e,s;if(r){if(t){i[t]=e}else{i.milliseconds=e}}return new C(i)},isDuration:function(e){return e instanceof C},humanize:function(){return"Must Implement"},add:function(e,t){var n=this.duration(t,e).valueOf(),r=this.gDate.valueOf()+n;return new k(r)},subtract:function(e,t){var n=this.duration(t,e).valueOf(),r=this.gDate.valueOf()-n;return new k(r)},formatNumber:true,format:function(i){function a(i){formatToPersian=s.formatNumber;switch(i){case"a":{if(formatToPersian)return u.hour>=12?"ب ظ":"ق ظ";else return u.hour>=12?"PM":"AM"};case"H":{if(formatToPersian)return r(u.hour);else return u.hour};case"HH":{if(formatToPersian)return r(f(u.hour,2));else return f(u.hour,2)};case"m":{if(formatToPersian)return r(u.minute);else return u.minute};case"mm":{if(formatToPersian)return r(f(u.minute,2));else return f(u.minute,2)};case"s":{if(formatToPersian)return r(u.second);else return u.second};case"ss":{if(formatToPersian)return r(f(u.second,2));else return f(u.second,2)};case"D":{if(formatToPersian)return r(f(u.date));else return f(u.date)};case"DD":{if(formatToPersian)return r(f(u.date,2));else return f(u.date,2)};case"DDD":{return t[s.pDate.weekDayNumber].abbr.fa};case"DDDD":{return t[s.pDate.weekDayNumber].name.fa};case"dddd":{return n[s.pDate.monthDayNumber]};case"M":{if(formatToPersian)return r(u.month);else return u.month};case"MM":{if(formatToPersian)return r(f(u.month,2));else return f(u.month,2)};case"MMM":{return e[u.month].abbr.fa};case"MMMM":{return e[u.month].name.fa};case"YY":{var o=u.year.toString().split("");if(formatToPersian)return r(o[2]+o[3]);else return o[2]+o[3]};case"YYYY":{if(formatToPersian)return r(u.year);else return u.year};case"Z":{if(formatToPersian)return r(u.timezone);else return u.timezone};case"ZZ":{if(formatToPersian)return r(u.timezone);else return u.timezone};case"L":{return s.format("YYYY/MM/DD")};case"LL":{return s.format(" MMM DD YYYY")};case"LLL":{return s.format(" MMM DD YYYY -- HH:m:ss - a")};case"LLLL":{return s.format(" MMM DDDD YYYY -- HH:m:ss - a")};default:return u._d}}var s=this,o=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|dddd?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?|LT|LL?L?L?)/g,u={year:s.year(),month:s.month(),hour:s.hours(),minute:s.minutes(),second:s.seconds(),date:s.date(),timezone:s.zone()};if(i){return i.replace(o,a)}else{var i="YYYY-MM-DD HH:mm:ss a";return i.replace(o,a)}},from:function(){return"Must Implement"},fromNow:function(){return"Must Implement"},humanizeDuration:function(){return"Must Implement"},_d:function(){return this.gDate._d},diff:function(e,t,n){var r=new k(this),i=e,s=0,o=r.gDate-i.gDate-s,u=r.year()-i.year(),a=r.month()-i.month(),f=(r.date()-i.date())*-1,l;if(t==="months"){l=u*12+a+f/30}else if(t==="years"){l=u+(a+f/30)/12}else{l=t==="seconds"?o/1e3:t==="minutes"?o/6e4:t==="hours"?o/36e5:t==="days"?o/864e5:t==="weeks"?o/6048e5:o}if(l<0)l*=-1;return n?l:Math.round(l)},startOf:function(e){switch(e){case"year":return new k([this.year(),1,1]);case"month":return new k([this.year(),this.month(),1]);case"day":return new k([this.year(),this.month(),this.date(),0,0,0]);case"hour":return new k([this.year(),this.month(),this.date(),this.hours(),0,0]);case"minute":return new k([this.year(),this.month(),this.date(),this.hours(),this.minutes(),0]);case"second":return new k([this.year(),this.month(),this.date(),this.hours(),this.minutes(),this.seconds()]);case"week":var t=this.pDate.weekDayNumber;if(t===0){return new k([this.year(),this.month(),this.date()])}else{return(new k([this.year(),this.month(),this.date()])).subtract("days",t)};default:return this}},endOf:function(e){switch(e){case"year":var t=this.isLeapYear()?30:29;return new k([this.year(),12,t,23,59,59]);case"month":var n=this.daysInMonth(this.year(),this.month());return new k([this.year(),this.month(),n,23,59,59]);case"day":return new k([this.year(),this.month(),this.date(),23,59,59]);case"hour":return new k([this.year(),this.month(),this.date(),this.hours(),59,59]);case"minute":return new k([this.year(),this.month(),this.date(),this.hours(),this.minutes(),59]);case"second":return new k([this.year(),this.month(),this.date(),this.hours(),this.minutes(),this.seconds()]);case"week":var r=this.pDate.weekDayNumber;if(r===6){r=7}else{r=6-r}return(new k([this.year(),this.month(),this.date()])).add("days",r);default:return this}},sod:function(){return this.startOf("day")},eod:function(){return this.endOf("day")},zone:function(){return this.pDate.timeZoneOffset},_utcMode:false,local:function(){if(!this._utcMode){return this}else{var e=this.pDate.timeZoneOffset*60*1e3;if(this.pDate.timeZoneOffset<0){var t=this.valueOf()-e}else{var t=this.valueOf()+e}this.gDate=new Date(t);this._updatePDate();this._utcMode=false;return this}},utc:function(){if(this._utcMode){return this}else{var e=this.pDate.timeZoneOffset*60*1e3;if(this.pDate.timeZoneOffset<0){var t=this.valueOf()+e}else{var t=this.valueOf()-e}this.gDate=new Date(t);this._updatePDate();this._utcMode=true;return this}},isUtc:function(){return this._utcMode},isDST:function(){var e=false;if(this.month()>=1&&this.month()<=6){e=true;switch(this.month()){case 1:if(this.date()<2){e=false}break;case 6:if(this.date()>30){e=false}break}}return e},isLeapYear:function(){return m(this.year())},daysInMonth:function(e,t){if(t<1||t>12)return 0;if(t<7)return 31;if(t<12)return 30;if(m(e))return 30;return 29},toDate:function(){return this.gDate},_valueOf:function(){return this.gDate.valueOf()},unix:function(e){if(e){return new persianDate(e*1e3)}else{var t=this.gDate.valueOf().toString();output=t.substring(0,t.length-3)}return parseInt(output)},isPersianDate:function(e){return e instanceof k},milliseconds:function(e){if(e){this.gDate.setMilliseconds(e);this._updatePDate();return this}else{return this.pDate.milliseconds}},seconds:function(e){if(e){this.gDate.setSeconds(e);this._updatePDate()}else{return this.pDate.seconds}},minutes:function(e){if(e){this.gDate.setMinutes(e);this._updatePDate()}else{return this.pDate.minutes}},hours:function(e){if(e){this.gDate.setHours(e);this._updatePDate()}else{return this.pDate.hours}},date:function(e){if(e){var t=N(this.pDate);t[2]=e;this.gDate=T(t);this._updatePDate()}else{return this.pDate.date}},day:function(){return this.pDate.day+2},month:function(e){if(e){var t=N(this.pDate);t[1]=e;this.gDate=T(t);this._updatePDate()}else{return this.pDate.month}},year:function(e){if(e){var t=N(this.pDate);t[0]=e;this.gDate=T(t);this._updatePDate()}else{return this.pDate.year}},getDaysInMonth:function(e,t){if(t<1||t>12)return 0;if(t<7)return 31;if(t<12)return 30;if(m(e))return 30;return 29},getFirstWeekDayOfMonth:function(e,t){var n=E(e,t,1),r=S(n[0],n[1],n[2]);if(r[3]+2===8){return 1}else if(r[3]+2===7){return 7}else{return r[3]+2}},clone:function(){var e=this;return new k(e.gDate)},version:.1,_updatePDate:function(){this.pDate=x(this.gDate)},valueOf:function(){return this._valueOf()}};persianDate=k;persianDate.unix=persianDate.prototype.unix})()